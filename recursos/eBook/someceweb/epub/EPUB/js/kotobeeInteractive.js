function kInteractionStart(){this.log=function(e){},kInteractive.setDOMParser(),kInteractive.preRender(),kInteractive.postRender()}function kInteractionStartSingleElem(e){kInteractive.setDOMParser(),kInteractive.preRender(e,!0),kInteractive.postRender(e,!0)}var kInteractive={scormWrapper:null,preRender:function(e,t){new DOMParser;var n,i=e||document;t?(n=[e],i=document):n=i.getElementsByClassName("kInteractive");for(var a=n.length;a--;){var r=n[a];if(this.hasClass(r,"gallery")){var o=i.createDocumentFragment(),s=kInteractive.readData(r);if(!s)continue;r.innerHTML="";var c=document.createElement("div");c.className="images "+s.scale;for(C=0;C<s.imgs.length;C++){var l=document.createElement("div");l.className="imgContainer"+(C?"":" selected");Y="undefined"==typeof isKotobee?s.imgs[C].path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,s.imgs[C].path);l.setAttribute("style","background-color:"+s.bgColor+";background-image:url('"+Y+"')"+(C?"":";display:block")),c.appendChild(l)}o.appendChild(c);var d=document.createElement("a");d.className="next btn ki-btn",1==s.imgs.length&&(d.className+=" disable"),o.appendChild(d);var u=document.createElement("a");u.className="prev btn ki-btn disable",o.appendChild(u),"undefined"==typeof isKotobee&&(d.addEventListener("click",this.actionEvent),u.addEventListener("click",this.actionEvent)),r.appendChild(o)}if(this.hasClass(r,"questions")){var o=i.createDocumentFragment(),m=kInteractive.readData(r);if(!m)continue;var p=m.dict,h=m.userDict;p||(p={}),h||(h=p),m.options||(m.options={}),r.id||(r.id="ki-qs-"+a+"-"+Math.ceil(1e3*Math.random()));if(r.innerHTML="",m.layout&&m.layout.popup&&!this.hasClass(r,"inpopup")){var v=document.createElement("img"),f=m.layout.popupImg;v.src=f,o.appendChild(v),"undefined"==typeof isKotobee&&v.addEventListener("click",this.actionEvent),r.appendChild(o);continue}if(m.options.randomize){for(C=0;C<m.q.length;C++)m.q[C].origin=C;for(var g,y,b=m.q.length;0!==b;)y=Math.floor(Math.random()*b),b-=1,g=m.q[b],m.q[b]=m.q[y],m.q[y]=g}if(m.options.questionsDisplayed){var k=Number(m.options.questionsDisplayed);m.q=m.q.slice(0,k)}if(m.title){var I=document.createElement("span");I.innerHTML="<h4>"+kInteractive.escapeHtml(m.title)+"</h4>",o.appendChild(I)}for(var C=0;C<m.q.length;C++){var E=m.q[C],w=document.createElement("div");if(w.className="ques",null!=E.origin&&w.setAttribute("data-o",E.origin),w.innerHTML="<p><strong>"+(C+1)+". "+kInteractive.escapeHtml(E.q)+"</strong></p>",E.path){var N=document.createElement("img");N.src=E.path,w.appendChild(N)}if("sa"==E.type){var A=E.lines?E.lines:1,x=document.createElement(A>1?"textarea":"input");x.name="sa-"+C,1==A?x.type="text":x.rows=E.lines?E.lines:1,x.className="ans txtfield";q="ki-sa-"+a+"-"+C;x.id=q,document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[C]&&(x.value=document[r.id].q[C]),w.appendChild(x)}else if("mcq"==E.type||"mmcq"==E.type)for(var T=E.c,L=0;L<T.length;L++){var q="ki-mcq-"+a+"-"+C+"-"+L,B=document.createElement("input");"mmcq"==E.type?(B.name="name",B.type="checkbox"):(B.name="mcq-"+C,B.type="radio"),B.className="ans",B.id=q,(K=document.createElement("label")).htmlFor=q,K.innerHTML=" "+kInteractive.escapeHtml(T[L].t)+"<br/>",K.className="ki-noHighlight",(H=document.createElement("div")).className="answer",document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[C]&&(B.checked=document[r.id].q[C][L],m.options&&m.options.highlightCorrect&&m.q[C].c[L].a&&kInteractive.c.addClass(H,"correct")),H.appendChild(B),H.appendChild(K),w.appendChild(H)}else if("tf"==E.type)for(L=0;L<2;L++){var q="ki-tf-"+a+"-"+C+"-"+L,S=document.createElement("input");S.type="radio",S.name="tf-"+C,S.className="ans",S.id=q,(K=document.createElement("label")).htmlFor=q,E.choice1&&E.choice2?K.innerHTML=kInteractive.escapeHtml(" "+(0==L?E.choice1:E.choice2)):K.innerHTML=" "+(0==L?"True":"False"),K.className="ki-noHighlight";var H=document.createElement("div");document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[C]&&(S.checked=document[r.id].q[C][L],m.options&&m.options.highlightCorrect&&(0==L&&m.q[C].a||1==L&&!m.q[C].a)&&kInteractive.c.addClass(H,"correct")),H.appendChild(S),H.appendChild(K),w.appendChild(H)}if((W=document.createElement("p")).className="separator",w.appendChild(W),document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[C]){if(m.q[C].exp&&!w.getElementsByClassName("explanation").length){var M=document.createElement("p");M.className="explanation",M.innerHTML=kInteractive.escapeHtml(m.q[C].exp),w.appendChild(M)}if(m.q[C].ref&&!w.getElementsByClassName("reference").length){var R=document.createElement("a");R.className="reference",R.innerHTML=h.learnMode?h.learnMode:"Learn more",R.setAttribute("href",kInteractive.escapeHtml(m.q[C].ref)),R.setAttribute("target","_blank"),w.appendChild(R)}}o.appendChild(w)}if(m.options.emailForm){var O=document.createElement("div");O.setAttribute("class","emailForm"),function(e,t,n){var i=document.createElement("div");i.className="address",i.innerHTML="<p><strong>"+e+"</strong><em>"+t+"</em></p>";var a=document.createElement("input");a.name=n,a.type="text",a.className="txtfield",i.appendChild(a);var r=document.createElement("p");r.className="separator",i.appendChild(r),O.appendChild(i)}(h.recipientEmail?h.recipientEmail:"Recipient email",h.separateEmails?h.separateEmails:"Separate multiple emails with commas","recipientEmail"),o.appendChild(O)}var D=null;if("none"!=m.action){var F="ki-"+a+"-btn";(D=document.createElement("input")).type="submit",D.value=h.submit?h.submit:"Submit Answers",D.id=F,D.className="btn ki-btn ki-mcq"}var P=null,j=null;if(m.options&&(m.options.clearAnswers&&((P=document.createElement("input")).type="submit",P.value=h.clear?h.clear:"Clear Answers",P.className="btn ki-btn ki-questions questions-clear","undefined"==typeof isKotobee&&P.addEventListener("click",this.actionEvent)),m.options.addToNotebook&&((P=document.createElement("input")).type="submit",P.value=h.notebook?h.notebook:"Save to Notebook",P.className="btn ki-btn ki-questions questions-notebook","undefined"==typeof isKotobee&&P.addEventListener("click",this.actionEvent)),m.options.preserveAnswers)){(j=document.createElement("div")).style.marginTop="5px";var z=document.createElement("input");z.type="checkbox",z.name="preserveAnswers",z.className="ki-btn ki-questions questions-preserve",z.id="ki-"+a+"-preserveAnswersBtn",document[r.id]&&(z.checked=document[r.id].preserve),j.appendChild(z);var K=document.createElement("label");K.htmlFor=z.id,K.innerHTML=" "+(h.preserve?h.preserve:"Preserve submitted answers"),K.className="ki-noHighlight",j.appendChild(K),"undefined"==typeof isKotobee&&z.addEventListener("change",this.actionEvent)}"undefined"==typeof isKotobee&&D&&D.addEventListener("click",this.actionEvent),D&&o.appendChild(D),o.appendChild(document.createTextNode(" ")),P&&o.appendChild(P),j&&o.appendChild(j);var W=document.createElement("p");W.className="separator",o.appendChild(W),m.options.rtl?r.style.direction="rtl":r.style.direction="ltr",r.appendChild(o)}if(this.hasClass(r,"image")){if(r.parentNode&&this.hasClass(r.parentNode,"link"))continue;"undefined"==typeof isKotobee&&r.addEventListener("click",this.actionEvent)}if(this.hasClass(r,"link")){var U=kInteractive.readData(r);if(!U)continue;if("undefined"!=typeof editorMode&&editorMode)continue;if("div"==r.nodeName.toLowerCase()){var _=document.createElement("a");_.setAttribute("href","popup"==U.type?"":r.getAttribute("href")),_.setAttribute("target",U.target),_.setAttribute("style",r.getAttribute("style")),_.setAttribute("data-kotobee",r.getAttribute("data-kotobee")),_.className="kInteractive link btn",_.style.opacity=Number(U.transparency)/100,r.parentNode.replaceChild(_,r),r=_}"undefined"==typeof isKotobee&&("popup"!=U.type&&"audio"!=U.type||r.setAttribute("onclick","return false;"),r.addEventListener("click",this.actionEvent))}if(this.hasClass(r,"container")){var V=kInteractive.readData(r);if(!V)continue;if(V.path){var Y=V.path;"undefined"!=typeof isKotobee&&(Y=ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,V.path));var Q=r.getAttribute("style");r.setAttribute("style",Q+' background-image:url("'+Y+'");')}"cScroll"==V.type&&kInteractive.isMobile()&&(r.style.minHeight=r.style.height,r.style.height="auto",r.style.overflowY=null)}}},clearAudioVideo:function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),i=n.length;i--;)try{n[i].pause(),n[i].children.length||(n[i].src="")}catch(e){}for(var a=t.getElementsByTagName("video"),i=a.length;i--;)a[i].pause(),a[i].children.length||(a[i].src="")},postRender:function(e,t){kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.currentVideo=kInteractive.currentAudio=null,kInteractive.clearAudioVideo(e);var n,i=e||document;t?(n=[e],i=document):n=i.getElementsByClassName("kInteractive");for(var a=n.length;a--;){var r=n[a];if(this.hasClass(r,"questions")){var o=kInteractive.readData(r);if(!o)continue;var s=o.dict,c=o.userDict;s||(s={}),c||(c=s);for(var l=r.getElementsByClassName("ques"),d=r.getElementsByClassName("explanation"),u=d.length;u--;)d[u].parentNode.removeChild(d[u]);for(var m=r.getElementsByClassName("reference"),u=m.length;u--;)m[u].parentNode.removeChild(m[u]);for(var p=0;p<l.length;p++){var h=l[p].getElementsByClassName("ans"),v=(h.length,p);if(o.options.randomize&&(v=Number(l[p].getAttribute("data-o"))),document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]){if(o.q[v].exp&&!l[p].getElementsByClassName("explanation").length){var f=document.createElement("p");f.className="explanation",f.innerHTML=kInteractive.escapeHtml(o.q[v].exp),l[p].appendChild(f)}if(o.q[v].ref&&!l[p].getElementsByClassName("reference").length){var g=document.createElement("a");g.className="reference",g.innerHTML=c.learnMode?c.learnMode:"Learn more",g.setAttribute("href",kInteractive.escapeHtml(o.q[v].ref)),g.setAttribute("target","_blank"),l[p].appendChild(g)}}for(u=0;u<h.length;u++)kInteractive.c.removeClass(h[u].parentNode,"correct"),h[u].getAttribute("id").indexOf("ki-tf-")>=0?document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]&&(h[u].checked=document[r.id].q[v][u],o.options&&o.options.highlightCorrect&&(0==u&&o.q[v].a||1==u&&!o.q[v].a)&&kInteractive.c.addClass(h[u].parentNode,"correct")):h[u].getAttribute("id").indexOf("ki-sa-")>=0?document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]&&(h[u].value=document[r.id].q[v]):document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[v]&&(h[u].checked=document[r.id].q[v][u],o.options&&o.options.highlightCorrect&&o.q[v].c[u].a&&kInteractive.c.addClass(h[u].parentNode,"correct"));if(document[r.id]){var y=r.getElementsByClassName("questions-preserve");y.length&&(y[0].checked=document[r.id].preserve)}}}else if(this.hasClass(r,"widget")){var b=i.createDocumentFragment(),k=kInteractive.readData(r);if(!k)continue;var I=k.name,C=k.src,E=k.width,w=k.height;if("page"==k.mode){if(r.children.length)continue;var N=document.createElement("div");N.className="cover",b.appendChild(N),k.interaction&&(N.style.pointerEvents="none");var A=document.createElement("div");A.className="iframeContainer";var x=document.createElement("iframe");x.setAttribute("nwdisable","true"),x.setAttribute("nwfaketop","true"),x.setAttribute("width",r.style.width?r.style.width:E+k.widthUnit),x.setAttribute("height",r.style.height?r.style.height:w+"px"),x.src=kInteractive.getWidgetUrl(k),A.appendChild(x),b.appendChild(A);var T=r.style.width,L=r.style.height;T.indexOf("px")>=0&&(k.widthUnit="px"),T.indexOf("%")>=0&&(k.widthUnit="%");try{k.widthUnit?k.width=Number(T.split(k.widthUnit)[0]):k.width=Number(T)}catch(e){k.width=Number(T)}try{k.height=Number(L.split("px")[0])}catch(e){k.height=Number(L)}kInteractive.writeData(r,k)}else{if(r.setAttribute("wdgt-src",C),r.setAttribute("wdgt-name",I),!r.children.length&&!r.innerHTML.trim()){var q=document.createElement("img");q.src=kInteractive.getWidgetHome(k)+"/"+I+"/Icon.png",b.appendChild(q)}"undefined"==typeof isKotobee&&r.addEventListener("click",this.actionEvent)}r.appendChild(b)}else if(this.hasClass(r,"video")){var b=i.createDocumentFragment(),B=kInteractive.readData(r);if(!B)continue;var S="";if(B.splash&&(S="undefined"==typeof isKotobee?B.splash:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,B.splash)),S){r.style.backgroundImage=null;var H=r.style.cssText;r.setAttribute("style","background-image:url('"+S+"');"+H)}r.setAttribute("id","ki-video-"+a),r.innerHTML="",(M=document.createElement("div")).setAttribute("id","ki-video-"+a+"-container"),M.className="container",(R=document.createElement("a")).className="playBtn ki-btn","undefined"==typeof isKotobee&&R.addEventListener("click",this.actionEvent),b.appendChild(R),b.appendChild(M),r.appendChild(b),B.autoplay&&kInteractive.action(r)}else if(this.hasClass(r,"audio")){b=i.createDocumentFragment(),kInteractive.readData(r);r.setAttribute("id","ki-audio-"+a),r.innerHTML="";var M=document.createElement("div");M.setAttribute("id","ki-audio-"+a+"-container"),M.className="container";var R=document.createElement("a");R.className="playBtn ki-btn","undefined"==typeof isKotobee&&R.addEventListener("click",this.actionEvent),b.appendChild(R),b.appendChild(M),r.appendChild(b)}else if(this.hasClass(r,"threed")){var b=i.createDocumentFragment(),O=kInteractive.readData(r);if(!O)continue;r.innerHTML="";var D=r.getAttribute("style");O.inter.placeholderPath&&(D+="background-image:url('"+("undefined"==typeof isKotobee?O.inter.placeholderPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,O.inter.placeholderPath))+"');"),r.setAttribute("style",D);var F=document.createElement("a");O.inter.includeMsg?(F.innerHTML=kInteractive.escapeHtml(O.inter.msg),F.className="msgBtn ki-btn"):F.className="invisibleBtn ki-btn",b.appendChild(F),"undefined"==typeof isKotobee&&F&&F.addEventListener("click",this.actionEvent),r.appendChild(b)}else if(this.hasClass(r,"gallery"));else if(this.hasClass(r,"image")){var P=kInteractive.readData(r);if(!P)continue;P&&(P.behavior&&"none"!=P.behavior||(r.style.transition=r.style.webkitTransition=r.style.mozTransition="none"))}}this.firstRun&&(window.addEventListener("resize",function(n){kInteractive.resizeEvent(e,t)}),this.firstRun=!1),kInteractive.resizeEvent(e,t)},actionEvent:function(e){kInteractive.action(e.target)},action:function(e,t){function n(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}function i(){var e="Questions: "+v+". Score: "+g+" questions out of "+b;e+=". Action: "+K,"selfAnswerReport"==K&&(e+=". Details: "+k),kInteractive.tinCan({verb:"solved",activity:e})}function a(){le||(kInteractive.c.addClass(ue,"hide"),le=!0)}function r(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function o(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function s(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}function c(e){var t=document.createElement("video");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("src",e),t.setAttribute("autoplay","true"),t.setAttribute("data-tap-disabled","false");var n;0!=e.indexOf("http://")&&0!=e.indexOf("https://")||(n=!0),n&&t.setAttribute("crossorigin","anonymous"),t.setAttribute("type","video/mp4"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("controls","true"),t.className="ki-noHighlight",Ee.hideDownloadBtn&&(t.className+=" hideDownloadBtn"),t.innerHTML="Your browser doesn't support HTML5 video.",n&&(t.crossOrigin="anonymous"),t.oncanplay=function(){kInteractive.currentVideo==d&&(Ne.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+e}))},t.addEventListener("error",function(e){kInteractive.stopCurrentMedia()}),t.addEventListener("webkitfullscreenchange",function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t});var i=d.getElementsByClassName("container")[0];i.setAttribute("data-tap-disabled","true"),i.appendChild(t)}function l(){function e(e){function n(t){if(!(t>=Be.objects.length)){var i=Be.objects[t],r="undefined"==typeof isKotobee?i.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,i.path);new THREE.OBJLoader(l).load(r,function(r){Se&&Se.parentNode&&Se.parentNode.removeChild(Se),a.domElement.parentNode||e.appendChild(a.domElement),r.position.set(i.x,i.y,i.z),r.traverse(function(e){if(e instanceof THREE.Mesh){var a=e==r.children[r.children.length-1];if(i.textPath){var o=new THREE.ImageLoader(l),s="undefined"==typeof isKotobee?i.textPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,i.textPath);o.load(s,function(i){var o=new THREE.Texture;o.image=i,o.needsUpdate=!0,e.material.map=o,a&&c.add(r),n(++t)},function(){},function(e){})}else a&&c.add(r),n(++t)}})},function(e){e.lengthComputable&&(e.loaded,e.total)},function(e){})}}function i(){a.render(c,s);g.getDelta();t=requestAnimFrame(i)}kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("_3D",Be.name?Be.name:"Model"),e.description="Opened 3D model: "+(Be.name?Be.name:"No name"),e.learnerResponses="Viewed",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800),t&&cancelAnimationFrame(t);var a;a=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?new THREE.WebGLRenderer({precision:"highp"}):new THREE.CanvasRenderer;var r=e.offsetWidth,o=e.offsetHeight,s=new THREE.PerspectiveCamera(Be.camera.viewAngle,r/o,Be.camera.near,Be.camera.far),c=new THREE.Scene;null!=Be.scene.bgColor&&a.setClearColor(Be.scene.bgColor,1),c.add(s),s.position.x=Be.camera.x,s.position.y=Be.camera.y,s.position.z=Be.camera.z,a.setSize(r,o),Be.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:Be.scene.floorColor?Be.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,c.add(floor));var l=new THREE.LoadingManager;l.onProgress=function(e,t,n){},n(0),new THREE.OrbitControls(s,a.domElement).target=new THREE.Vector3(0,0,0);for(var d=0;d<Be.lights.length;d++)if("pointLight"==Be.lights[d].type){var u=new THREE.PointLight(Be.lights[d].color);u.position.set(Be.lights[d].x,Be.lights[d].y,Be.lights[d].z),c.add(u)}else if("directionalLight"==Be.lights[d].type){var m=new THREE.DirectionalLight(Be.lights[d].color,Be.lights[d].intensity);m.position.set(Be.lights[d].x,Be.lights[d].y,Be.lights[d].z),c.add(m)}else if("hemisphereLight"==Be.lights[d].type){var p=new THREE.HemisphereLight(Be.lights[d].sky,Be.lights[d].ground,Be.lights[d].intensity);p.position.set(Be.lights[d].x,Be.lights[d].y,Be.lights[d].z),c.add(p)}else if("spotLight"==Be.lights[d].type){var h=new THREE.SpotLight(Be.lights[d].color,Be.lights[d].intensity,Be.lights[d].distance,Be.lights[d].angle,Be.lights[d].exponent,Be.lights[d].decay);h.position.set(Be.lights[d].x,Be.lights[d].y,Be.lights[d].z),c.add(h)}else if("ambientLight"==Be.lights[d].type){var v=new THREE.AmbientLight(Be.lights[d].color);c.add(v)}else if("areaLight"==Be.lights[d].type){var f=new THREE.AreaLight(Be.lights[d].color,Be.lights[d].intensity);c.add(f)}var g=new THREE.Clock;i()}var t,n=d;if("inPanel"==Be.inter.target){var i={};i.class="threed",i.cb=function(t){var n=document.createElement("div");n.className="container",t.appendChild(n),e(n)},i.closed=function(){kInteractive.c.removeClass(d,"running")},kInteractive.openFrame(i)}else e(n)}if("undefined"==typeof editorMode||!editorMode){for(var d=e;!this.hasClass(d,"kInteractive");){if(!d.parentNode)return;if((d=d.parentNode)==document.body)return}if(this.hasClass(d,"questions")){var u=kInteractive.readData(d);if(!u)return;var m=u.dict,p=u.userDict;if(m||(m={}),p||(p=m),u.layout&&u.layout.popup&&!this.hasClass(d,"inpopup")&&"img"==e.nodeName.toLowerCase()){var h=document.getElementById("epubContent");return h&&d.setAttribute("data-loc",function(e,t){for(var i="";e!=t;)i=n(e)+"."+i,e=e.parentNode;return""==i?"":i.substr(0,i.length-1)}(d,h)),(re=document.createElement("iframe")).setAttribute("nwdisable","true"),re.setAttribute("nwfaketop","true"),u.cb=function(e){function t(){if("undefined"!=typeof isKotobee){var e={};e.root=re.contentDocument.documentElement.ownerDocument.body,e.rootIndex=d.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(e,function(){})}}var n,i=document.createElement("head");if("undefined"==typeof isKotobee){for(var a=document.getElementsByTagName("link"),r=0;r<a.length;r++){var o=a[r];if(o.getAttribute("href").indexOf("base.css")>=0){var s=o.getAttribute("href").split("/");delete s[s.length-1],n=s.join("/");break}}if(!n)return}var c="undefined"==typeof isKotobee?n+"../xhtml/":bookPath+"EPUB/xhtml/",i="<head>";if(i+='<base href="'+kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+c+'"/>',i+='<link rel="stylesheet" type="text/css" href="../css/base.css" />',i+='<link rel="stylesheet" type="text/css" href="../css/global.css" />',i+='<link rel="stylesheet" type="text/css" href="../css/kotobeeInteractive.css" />',i+='<script type="text/javascript" src="../js/kotobeeInteractive.js"><\/script>',i+='<script type="text/javascript" src="../js/global.js"><\/script>',"undefined"!=typeof isKotobee){var l=clone(config);l.kotobee.email=angular.element(document.body).scope().data.user.email,i+='<script type="text/javascript">var config='+JSON.stringify(l)+";<\/script>"}i+='<meta charset="utf-8" />',i+="</head>";var u=d.outerHTML;u=(u=(u=(u=(u=(u=u.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var m="<html>"+i+"<body>"+(u+='<div class="vSpace20"></div>')+"</body></html>";re.setAttribute("srcdoc",m);var p="javascript: window.frameElement.getAttribute('srcdoc');";re.setAttribute("src",p),re.contentWindow&&(re.contentWindow.location=p),e.appendChild(re),re.addEventListener?re.addEventListener("load",t,!0):re.attachEvent&&re.attachEvent("onload",t)},u.closed=function(){},u.pos=u.layout.pos,kInteractive.openFrame(u),kInteractive.tinCan({verb:"opened",activity:"Questions: "+u.title}),void(kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("question",u.title),e.description="Opened question popup: "+u.title,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800))}var v="Untitled questions",f=d.getElementsByTagName("h4");f.length&&(v=f[0].textContent||f[0].data);var g=0,y=d.getElementsByClassName("ques"),b=y.length,k="";if(this.hasClass(e,"kInteractive"))return;if(this.hasClass(e,"questions-clear")){for(var I=d.getElementsByClassName("ans"),C=0;C<I.length;C++)I[C].checked=!1,I[C].value=null,kInteractive.c.removeClass(I[C].parentNode,"correct");for(C=(F=d.getElementsByClassName("explanation")).length;C--;)F[C].parentNode.removeChild(F[C]);for(C=(P=d.getElementsByClassName("reference")).length;C--;)P[C].parentNode.removeChild(P[C]);return void(document[d.id]=null)}if(this.hasClass(e,"questions-notebook")){var E=u.layout&&u.layout.popup&&this.hasClass(d,"inpopup");if("undefined"==typeof isKotobee&&!E)return void kInteractive.alert({content:m.kotobeeOnly,title:p.sorry?p.sorry:"Sorry"});var w,N={elem:d};if("undefined"!=typeof isKotobee)w=angular.element(document.body).scope();else{try{w=window.parent.getGlobal()}catch(e){return void kInteractive.alert({content:m.kotobeeOnly,title:p.sorry?p.sorry:"Sorry"})}N.rootIndex=d.getAttribute("data-loc"),N.root=d}return kInteractive.c.addClass(e,"busy"),void w.questionsAddToNotebookShortcut(N,function(){kInteractive.c.removeClass(e,"busy"),kInteractive.alert({content:p.savedToNotebook?p.savedToNotebook:"Saved to notebook!"})})}if(this.hasClass(e,"questions-preserve"))return document[d.id]||(document[d.id]={}),void(document[d.id].preserve=e.checked);for(var A=0,x=0,T=[],C=0;C<y.length;C++){var L=(I=y[C].getElementsByClassName("ans")).length>0,q=u.q[C];if(u.options.randomize&&(q=u.q[Number(y[C].getAttribute("data-o"))]),kInteractive.scorm&&u.options&&u.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(d.id+"-"+(C+1),q.q))){oe="<p style='text-align:center'>"+(p.alreadySubmitted?p.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:oe})}var B={};T.push(B),B.id=kInteractive.getScormId(d.id+"-"+(C+1),q.q),B.qid=d.id,B.type=I[0].getAttribute("id").indexOf("ki-tf-")>=0?"true-false":"choice",B.objective=u.options?u.options.objective:null,B.timestamp=kInteractive.timestamp,B.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),B.description=q.q;for(ee=0;ee<I.length;ee++)if(I[ee].getAttribute("id").indexOf("ki-tf-")>=0)0==ee&&q.a?B.correctResponses=q.choice1:1!=ee||q.a||(B.correctResponses=q.choice2),I[ee].checked?(B.learnerResponses=ee?q.choice2:q.choice1,0!=ee||q.a?1==ee&&q.a&&(L=!1):L=!1):0==ee&&q.a?L=!1:1!=ee||q.a||(L=!1),u.options&&u.options.highlightCorrect&&(0==ee&&q.a||1==ee&&!q.a)&&kInteractive.c.addClass(I[ee].parentNode,"correct");else if(I[ee].getAttribute("id").indexOf("ki-sa-")>=0){($=I[ee].value.toLowerCase())&&($=$.trim()),L=!0;for(var S="",H=0;H<q.k.length;H++){var M=q.k[H].t;if(!M){L=!1;break}M=M.toLowerCase(),S&&(S+="+"),S+=M;for(var R=M.split(","),O=!1,D=0;D<R.length;D++)if($.indexOf(R[D].trim())>=0){O=!0;break}if(!O){L=!1;break}}B.correctResponses=S,B.learnerResponses=$}else q.c[ee].a&&(B.correctResponses=q.c[ee].t),I[ee].checked&&(B.learnerResponses=q.c[ee].t),I[ee].checked&&!q.c[ee].a?L=!1:!I[ee].checked&&q.c[ee].a&&(L=!1),u.options&&u.options.highlightCorrect&&q.c[ee].a&&kInteractive.c.addClass(I[ee].parentNode,"correct");if(B.result=0,null!=q.weight&&(A+=q.weight,L&&(x+=q.weight,B.result=q.weight)),B.scoreMax=u.options?Number(u.options.totalScore):null,q.exp&&!y[C].getElementsByClassName("explanation").length){var F=document.createElement("p");F.className="explanation",F.innerHTML=kInteractive.escapeHtml(q.exp),y[C].appendChild(F)}if(q.ref&&!y[C].getElementsByClassName("reference").length){var P=document.createElement("a");P.className="reference",P.innerHTML=p.learnMode?p.learnMode:"Learn more",P.setAttribute("href",kInteractive.escapeHtml(q.ref)),P.setAttribute("target","_blank"),y[C].appendChild(P)}var j=p.question?p.question.replace("[no]",C+1):"Question "+(C+1);L?(k+="<span style='border-bottom: dotted 1px #aaa;' title='"+q.q.replace(/'/g,"&#39;")+"'>"+j+".</span>  <span style='color:#366c20'>"+p.correct+"</span><br/>",g++):k+="<span style='border-bottom: dotted 1px #aaa;' title='"+q.q.replace(/'/g,"&#39;")+"'>"+j+".</span>  <span style='color:#7a1818'>"+p.incorrect+"</span><br/>"}for(C=0;C<T.length;C++)T[C].weighting=Math.round(1e3*u.options.totalScore/A)/1e3;var z,K=u.action;if(u.options.totalScore&&A&&(z=Math.round(10*u.options.totalScore*x/A)/10),"selfAnswer"==K||"selfAnswerReport"==K){var W="";"ar"==u.options.language&&(W=' direction="rtl"');oe="";if(p.scoreWeight){if(null!=z){var U="";u.options.passScore&&(z>=u.options.passScore||z==u.options.totalScore?U+=p.pass:U+=p.fail),U&&(U+=". "),oe+="<h3"+W+">"+(U||"")+p.scoreWeight.replace("[score]",z).replace("[total]",u.options.totalScore)+"</h3>"}oe+="<p"+W+">"+p.score.replace("[correct]",g).replace("[total]",b)+"</p>"}else oe="You scored "+g+" question(s) out of "+b;"selfAnswerReport"==K&&(oe="<p"+W+"><strong>"+oe+"</strong></p><p><strong>"+(p.details?p.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+k+"</p>"),kInteractive.alert({content:oe}),i()}if("email"==K||u.options.reportEmail||u.options.emailForm){var _="selfAnswer"!=K&&"selfAnswerReport"!=K&&"email"!=K;try{if(!config.kotobee.cloudid)return void(_&&kInteractive.alert({content:m.cloudOnly,title:p.sorry?p.sorry:"Sorry"}))}catch(e){return void(_&&kInteractive.alert({content:m.cloudOnly,title:p.sorry?p.sorry:"Sorry"}))}var V={};V.ans=new Array;for(ee=0;ee<y.length;ee++)for(var I=y[ee].getElementsByClassName("ans"),C=0;C<I.length;C++)I[C].checked&&V.ans.push({q:ee,index:C,label:I[C].nextSibling.textContent||I[C].nextSibling.data});if(V.title=v,(me={}).recipient=u.address,u.options.reportEmail&&(me.recipient=u.options.reportEmail),me.content=JSON.stringify(V),me.mode=config.kotobee.mode,me.cloudid=config.kotobee.cloudid,me.email=config.kotobee.email?config.kotobee.email:angular.element(document.body).scope().data.user.email,u.options.emailForm){var Y=document.getElementsByName("recipientEmail");Y.length&&(me.recipient=me.recipient?me.recipient+","+Y[0].value:Y[0].value)}var Q=e.value;e.value=p.submitting?p.submitting:"Submitting ..",e.setAttribute("disabled","true");var J=new XMLHttpRequest;J.onreadystatechange=function(){try{if(4===J.readyState&&200===J.status){if(e.value=Q,e.removeAttribute("disabled"),!_)return;JSON.parse(J.responseText).success?kInteractive.alert({content:p.submitted?p.submitted:"Answers submitted!"}):kInteractive.alert({content:p.errorSubmitting?p.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(t){if(e.value=Q,e.setAttribute("value",e.value),e.removeAttribute("disabled"),!_)return;kInteractive.alert({content:p.errorSubmitting?p.errorSubmitting:"An error has occurred while sending answers to the server"})}};ae=config.kotobee.liburl?config.kotobee.liburl:"http://www.kotobee.com/";ae+="library/report/questions",J.open("POST",ae),J.setRequestHeader("Content-type","application/x-www-form-urlencoded");var X="a=a";for(var G in me){var $=me[G];void 0!=$&&("object"!=typeof $&&("string"==typeof $&&($=encodeURIComponent($)),"boolean"==typeof $&&($=$?1:0),X+="&"+G+"="+$))}J.send(X),i()}document[d.id]||(document[d.id]={}),document[d.id].q=[];for(var Z=d.getElementsByClassName("ques"),ee=0;ee<Z.length;ee++){var te=ee;u.options.randomize&&(te=Number(Z[ee].getAttribute("data-o"))),document[d.id].q[te]=[];for(var ne=Z[ee].getElementsByClassName("ans"),C=0;C<ne.length;C++)kInteractive.hasClass(ne[C],"txtfield")?document[d.id].q[te][C]=ne[C].value:document[d.id].q[te][C]=ne[C].checked}kInteractive.scorm&&setTimeout(function(){kInteractive.scorm.setInteractions(T)},500)}else if(this.hasClass(d,"widget")){var ie=kInteractive.readData(d);if(!ie)return;var ae=kInteractive.getWidgetUrl(ie),re=document.createElement("iframe");re.setAttribute("nwdisable","true"),re.setAttribute("nwfaketop","true"),ie.cb=function(e){re.src=ae,e.appendChild(re)},ie.cb1="yes",ie.closed=function(){},kInteractive.openFrame(ie),kInteractive.tinCan({verb:"opened",activity:"Widget: "+ie.name}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("widget",ie.name),e.description="Opened popup widget: "+ie.name,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else{if(this.hasClass(e,"link")){if(!(me=kInteractive.readData(e)))return;if("popup"==me.type){var oe="<div class='kbAlertScroll'>"+me.msg+"</div>";kInteractive.alert({content:oe}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("popup",me.msg),e.description="Shown popup message: "+me.msg,e.type="other",e.learnerResponses="Shown",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else if("audio"==me.type){kInteractive.stopCurrentMedia();var se=document.createElement("audio"),ce=me.src;"file"==me.audioType&&(ce="undefined"==typeof isKotobee?me.audio:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,me.audio)),se.setAttribute("src",ce);var le,de=document.createElement("div");de.className="kiAudioLoader",de.style.transform=de.style.webkitTransform=de.style.mozTransform="scale(1)";var ue=document.createElement("div");ue.className="kiAudioSpinner",de.appendChild(ue),e.parentNode.insertBefore(de,e),se.onplaying=a,setTimeout(a,5e3),se.play(),kInteractive.currentAudio=se,kInteractive.tinCan({verb:"played",activity:"Audio: "+ce}),kInteractive.scorm&&((B={}).id=kInteractive.getScormId(e.textContent,ce),B.description="Played audio link: "+ce,B.type="other",B.learnerResponses="Played",B.objective=me.options?me.options.objective:null,B.timestamp=new Date,kInteractive.scorm.setInteractions([B]))}return!1}if(this.hasClass(e,"image")){if(e.parentNode&&this.hasClass(e.parentNode,"kInteractive")&&this.hasClass(e.parentNode,"link"))return void this.action(e.parentNode,t);var me=kInteractive.readData(e);if(!me)return;var pe=me.behavior;if("none"==pe)return;r(e,"none"),o(e,"none"),s(e,"none"),setTimeout(function(){function t(i){r(e,"none"),o(e,"none"),s(e,"none"),e.removeEventListener(n,t)}"wiggle"==pe?(r(e,"wiggle"),o(e,"0.5s"),s(e,"1")):"jump"==pe?(r(e,"jump"),o(e,"0.7s"),s(e,"1")):"scale"==pe&&(r(e,"scale"),o(e,"0.5s"),s(e,"1"));var n=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();n&&e.addEventListener(n,t)}),kInteractive.tinCan({verb:"clicked",activity:pe+"image: "+e.getAttribute("src")})}else if(this.hasClass(d,"gallery")){var he=d.getElementsByClassName("images")[0],g=he.children.length,ve=d.getElementsByClassName("selected")[0],fe=Number(ve.style.left.slice(0,-2)),ge=Number(he.style.left.slice(0,-2));if(this.hasClass(e,"next")){var ye=ve.nextSibling;if(!ye)return;kInteractive.c.removeClass(ve,"selected"),kInteractive.c.addClass(ye,"selected"),ye.style.left=fe+d.offsetWidth+"px",ye.style.display="block",he.style.left=ge-d.offsetWidth+"px",ye.nextSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(d.getElementsByClassName("prev")[0],"disable")}else if(this.hasClass(e,"prev")){var be=ve.previousSibling;if(!be)return;kInteractive.c.removeClass(ve,"selected"),kInteractive.c.addClass(be,"selected"),be.style.left=fe-d.offsetWidth+"px",be.style.display="block",he.style.left=ge+d.offsetWidth+"px",be.previousSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(d.getElementsByClassName("next")[0],"disable")}}else if(this.hasClass(d,"audio")){kInteractive.stopCurrentMedia();var ke=kInteractive.readData(d);if(!ke)return;ke.audioType||(ke.audioType=ke.type);we=d.getAttribute("id")+"-container";(Ne=d.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn hide";ce=ke.src;"file"==ke.audioType&&(ce="undefined"==typeof isKotobee?ke.audio:ke.relToRoot?ph.join(bookPath,ke.audio):ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,ke.audio)),kInteractive.scorm&&((B={}).id=kInteractive.getScormId(d.getAttribute("id"),ce),B.description="Played audio: "+ce,B.type="other",B.learnerResponses="Played",B.objective=ke.options?ke.options.objective:null,B.timestamp=new Date,kInteractive.scorm.setInteractions([B]));var Ie=document.createElement("audio");Ie.setAttribute("controls","true"),Ie.setAttribute("autoplay","true"),Ie.setAttribute("data-tap-disabled","false");var Ce=document.createElement("source");Ce.src=ce,Ie.appendChild(Ce),Ie.appendChild(document.createTextNode("Your browser does not support the audio element")),Ie.className="ki-noHighlight",Ie.oncanplay=function(){kInteractive.currentAudio==d&&kInteractive.tinCan({verb:"played",activity:"Audio: "+ce})},d.getElementsByClassName("container")[0].appendChild(Ie),Ie.play(),kInteractive.currentAudio=d,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}else if(this.hasClass(d,"video")){var Ee=kInteractive.readData(d);if(!Ee)return;var we=d.getAttribute("id")+"-container",Ne=d.getElementsByClassName("playBtn")[0];if(Ne.className.indexOf("loading")>=0)return;if(kInteractive.stopCurrentMedia(),Ne.className="playBtn ki-btn loading",Ee.autoplay&&(Ne.className="playBtn ki-btn hide"),kInteractive.scorm&&((B={}).id=kInteractive.getScormId(d.getAttribute("id"),Ee.src),B.description="Played video: "+Ee.src,B.type="other",B.learnerResponses="Played",B.objective=Ee.options?Ee.options.objective:null,B.timestamp=new Date,kInteractive.scorm.setInteractions([B])),"file"==Ee.type)c(ce="undefined"==typeof isKotobee?Ee.video:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,Ee.video));else if(Ee.src.indexOf("youtube.com")>=0||Ee.src.indexOf("youtu.be/")>=0){var Ae;if(Ee.src.indexOf("youtube.com")>=0)Ae=(xe=Ee.src.split("watch?v="))[1];else{if(!(Ee.src.indexOf("youtu.be/")>=0))return;var xe=Ee.src.split("youtu.be/");Ae=xe[xe.length-1]}if(window&&window.iBooks)return setTimeout(function(){Ne.className="playBtn ki-btn"},1500),void(window.location.href=Ee.src);var Te={videoId:Ae,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+Ee.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){Ne.className="playBtn ki-btn hide",new YT.Player(we,Te)}}else"ready"==kInteractive.youTubeStatus&&(Ne.className="playBtn ki-btn hide",new YT.Player(we,Te));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var Le=document.createElement("script");Le.src="https://www.youtube.com/player_api";var qe=document.getElementsByTagName("script")[0];qe.parentNode.insertBefore(Le,qe),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){Ne.className="playBtn ki-btn hide",new YT.Player(we,Te)}}}else c(Ee.src);kInteractive.currentVideo=d,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}else if(this.hasClass(d,"threed")){var Be=kInteractive.readData(d);if(!Be)return;"inPanel"==Be.inter.target?kInteractive.c.addClass(d,"running"):d.innerHTML="";var Se=document.createElement("div");if(Se.className="loading",d.appendChild(Se),"undefined"==typeof THREE){var He,Me=document.getElementsByTagName("head")[0],Re=Me.getElementsByTagName("script");if("undefined"!=typeof isKotobee)He=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(ee=0;ee<Re.length;ee++)if(Re[ee].src.indexOf("kotobeeinteractive.js")>=0){He=Re[ee].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!He)return;var Oe=document.createElement("script");Oe.type="text/javascript",Oe.src=He,Oe.onload=l,Oe.onreadystatechange=function(){"complete"==this.readyState&&l()},Me.appendChild(Oe)}else l()}}}},openFrame:function(e){function t(){i.style.display="block",i.className="show";var t=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;t-=20,r-=20;var o=1;if(e.width&&e.height){var s=r/e.width,l=t/e.height;(o=s<l?s:l)>1&&(o=1)}var d="display:block;";d+=a;var u=e.width||e.height?"-50%,-50%":"0%,0%";d+="-webkit-transform:translate("+u+") scale("+o+");-moz-transform:translate("+u+") scale("+o+");transform:translate("+u+") scale("+o+");",n.style.cssText=d,n.className=c+" ready";var m=n.getElementsByClassName("closeBtn");if(m.length){var p=m[0],h=1/o,v="-50%";kInteractive.hasClass(p,"side")&&(v="0%"),p.style.cssText="-webkit-transform: translate("+v+",0%) scale("+h+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+v+",0%) scale("+h+");-moz-transform-origin: 50% 50%;transform: translate("+v+",0%) scale("+h+");transform-origin: 50% 50%;"}}var n=document.getElementById("kInteractiveFrame"),i=document.getElementById("kiDarkOverlay"),a="";if(e.dict||(e.dict={}),e.width&&(a+="width:"+e.width+"px;max-width:"+e.width+"px;"),e.height&&(a+="height:"+e.height+"px;max-height:"+e.height+"px;"),n||((i=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(i),i.style.display="none",i.addEventListener("click",kInteractive.closeFrame),(n=document.createElement("div")).id="kInteractiveFrame"),e.pos||(e.pos="top"),"none"!=e.pos){var r=document.createElement("a"),o="closeBtn";e.pos&&(o+=" "+e.pos),r.className=o;var s=e.dict.close?e.dict.close:"Close";try{s=angular.element(document.body).scope().translit("close")}catch(e){}"side"!=e.pos&&(r.innerHTML=s),r.addEventListener("click",kInteractive.closeFrame),n.appendChild(r)}var c=e.class?e.class:"";(e.width||e.height)&&(c+=" fixed"),n.style.display="block",n.className=c,document.body.appendChild(n),kInteractive.frameIsOpen=!0,kInteractive.frameOb=e,kInteractive.openFrame.resized=t,window.addEventListener("resize",t),setTimeout(function(){t(),e.cb&&e.cb(n)},100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t.parentNode.removeChild(t),n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1},closeFrame:function(){var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,i="";n.width&&(i+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(i+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=i,t.className="",setTimeout(function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null},300)},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container";(t=document.getElementById(e))&&(t.parentNode.removeChild(t),(n=document.createElement("div")).setAttribute("id",e),n.className="container",(i=kInteractive.currentVideo.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),kInteractive.currentVideo.appendChild(n))}if(kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id")){e+="-container";var t=document.getElementById(e);if(t){t.parentNode.removeChild(t);var n=document.createElement("div");n.setAttribute("id",e),n.className="container";var i=kInteractive.currentAudio.getElementsByClassName("playBtn")[0];i.className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),kInteractive.currentAudio.appendChild(n)}}else try{var a=kInteractive.currentAudio.getElementsByTagName("audio");a.length&&(a[0].pause(),a[0].src="");for(var r=document.getElementsByClassName("kiAudioLoader"),o=r.length;o--;)r[o].parentNode.removeChild(r[o])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),i=0;i<n.length;i++)if(n[i]&&n[i].trim()==t)return!0},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,i=n.cloneNode(!1);return i.innerHTML=t,n.parentNode.replaceChild(i,n),i},tinCan:function(e){if("undefined"!=typeof isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){"use strict";var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var i,a=document.implementation.createHTMLDocument(""),r=a.documentElement;return r.innerHTML=e,i=r.firstElementChild,1===r.childElementCount&&"html"===i.localName.toLowerCase()&&a.replaceChild(i,r),a}return n.apply(this,arguments)}}(DOMParser)},readData:function(e){try{var t=e.getAttribute("data-kotobee");return t||(t=e.getAttribute("data")),JSON.parse(decodeURI(kInteractive.XORCipher().decode("kotobee%%author",t)))}catch(e){try{return JSON.parse(kInteractive.XORCipher().decode("kotobee%%author",t))}catch(e){}}},writeData:function(e,t){var n=encodeURI(JSON.stringify(t)),i=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(i,kInteractive.XORCipher().encode("kotobee%%author",n))},XORCipher:function(){function e(e){var t,n,i,a,r,s,c=0,l="";if(!e)return e;do{t=(r=e[c++]<<16|e[c++]<<8|e[c++])>>18&63,n=r>>12&63,i=r>>6&63,a=63&r,l+=o.charAt(t)+o.charAt(n)+o.charAt(i)+o.charAt(a)}while(c<e.length);return((s=e.length%3)?l.slice(0,s-3):l)+"===".slice(s||3)}function t(e){var t,n,i,a,r,s,c=0,l=[];if(!e)return e;e+="";do{t=(s=o.indexOf(e.charAt(c++))<<18|o.indexOf(e.charAt(c++))<<12|(a=o.indexOf(e.charAt(c++)))<<6|(r=o.indexOf(e.charAt(c++))))>>16&255,n=s>>8&255,i=255&s,l.push(t),64!==a&&(l.push(n),64!==r&&l.push(i))}while(c<e.length);return l}function n(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){return r(t,function(t,i){return t.charCodeAt(0)^n(e,i)})}function a(e,t){return r(t,function(t,i){return String.fromCharCode(t^n(e,i))}).join("")}function r(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t,n){return n=i(t,n),e(n)},decode:function(e,n){return n=t(n),a(e,n)}}},getScormId:function(e,t){return t&&(t=t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80)),e+"-"+t},alert:function(e){var t=document.createElement("div");t.setAttribute("id","kiSystemAlertBox");var n=document.createElement("div");n.innerHTML=e.content.replace("&nbsp;","&#160;"),n.className="content",t.appendChild(n);var i=document.createElement("div");if(i.className="footer",e.title){var a=document.createElement("div");a.innerHTML=e.title.replace("&nbsp;","&#160;"),a.className="header",t.insertBefore(a,t.firstChild)}var r=document.createElement("a"),o="OK";try{o=angular.element(document.body).scope().translit("ok")}catch(e){}r.innerHTML=o.replace("&nbsp;","&#160;"),r.className="okBtn",kInteractive.alertIsOpen=!0,r.addEventListener("click",kInteractive.closeAlert),i.appendChild(r),t.appendChild(i);var s=document.createElement("div");s.setAttribute("id","kiSystemAlertBackdrop"),s.addEventListener("click",kInteractive.closeAlert),document.body.appendChild(s),document.body.appendChild(t),r.focus(),setTimeout(function(){t.className="show",s.className="show"},50)},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)-1==n.indexOf(t[a])&&(i=!1,n+=(""==n?"":" ")+t[a]);if(i)return}else{if(n.indexOf(t)>=0)return;n+=(""==n?"":" ")+t}e.className=n},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)n.indexOf(t[a])>=0&&(i=!1,n=n.replace(t[a],""));if(i)return}else{if(-1==n.indexOf(t))return;n=n.replace(t,"")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);return-1==t[t.length-1].indexOf(".")?e:(t.splice(t.length-1,1),t.join("/"))},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&n>0&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t}},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},resizeEvent:function(e,t){function n(e,t){if(e&&e.disableWrapForMobile&&"none"!=e.float){var n=t.parentNode;t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow")}}var i,a=e||document;t&&(a=document);for(var r=(i=a.getElementsByClassName("kInteractive")).length;r--;){var o=i[r];if(this.hasClass(o,"image")){var s=kInteractive.readData(o);if(!s)return;n(s,o)}else if(this.hasClass(o,"gallery")){var c=kInteractive.readData(o);if(!c)return;n(c,o)}else if(this.hasClass(o,"container")){var l=kInteractive.readData(o);if(!l)return;n(l,o)}else if(this.hasClass(o,"video")){var d=kInteractive.readData(o);if(!d)return;if(n(d,o),!d.maintainRatio)continue;if("px"!=d.widthUnit)continue;if(!d.height||!d.width)continue;o.style.height=o.offsetWidth*(d.height/d.width)+"px"}else if(this.hasClass(o,"widget")){var u=kInteractive.readData(o);if(!u)return;if("page"!=u.mode)continue;if("px"!=u.widthUnit)continue;var m=u.width,p=u.height,h=o.parentNode;if(!h)continue;if(m>h.offsetWidth){var v=h.offsetWidth/m,f=o.children.length-1;o.children[f].style.transform=o.children[f].style.webkitTransform=o.children[f].style.mozTransform="scale("+v+")",o.children[f].style.transformOrigin=o.children[f].style.webkitTransformOrigin=o.children[f].style.mozTransformOrigin="0 0",o.style.maxWidth=o.style.width,o.style.height=Math.round(p*v)+"px"}else{for(f=0;f<o.children.length;f++)o.children[f].style.transform=o.children[f].style.webkitTransform=o.children[f].style.mozTransform=o.children[f].style.transformOrigin=o.children[f].style.webkitTransformOrigin=o.children[f].style.mozTransformOrigin=null;o.style.maxWidth=null,o.style.height=p+"px"}}}},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},closeFullscreenVideo:function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)},getWidgetHome:function(e){return e.path?"undefined"==typeof isKotobee?e.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/"},getWidgetUrl:function(e){var t=kInteractive.getWidgetHome(e)+"/"+e.name+"/"+e.src;if("undefined"!=typeof isKotobee){var n=angular.element(document.body).scope().data.user;n&&n.email&&n.signatures&&n.signatures.bookwidgets&&e.id&&0==e.id.indexOf("com.kidimedia")&&(t+="?oauth_signature="+n.signatures.bookwidgets.signature,t+="&oauth_nonce="+n.signatures.bookwidgets.nonce,t+="&oauth_timestamp="+n.signatures.bookwidgets.timestamp,t+="&oauth_consumer_key="+n.signatures.bookwidgets.key,t+="&lti_version=LTI-1p0",t+="&oauth_signature_method=HMAC-SHA1",t+="&oauth_version=1.0",t+="&tool_consumer_info_product_family_code=kotobee",t+="&lis_person_contact_email_primary="+n.email,t+="&lis_person_name_full="+(n.name?n.name:""),t+="&user_id="+n.id,t+="&lti_message_type=basic-lti-launch-request",angular.element(document.body).scope().refreshSignatures&&angular.element(document.body).scope().refreshSignatures())}return t},vQueue:[],youTubeReady:!1,firstRun:!0};if("undefined"==typeof isKotobee)try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}